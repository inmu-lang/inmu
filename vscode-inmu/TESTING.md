# INMU拡張機能 - 動作確認の完全ガイド

## 今すぐ試す：5ステップ

### ステップ1: ビルドの確認（元のVS Codeウィンドウ）

現在`npm run watch`が動いているので、自動でコンパイルされているはずです。
念のため確認：

```bash
ls -la out/
# extension.js と server.js が存在すればOK
```

### ステップ2: 拡張機能開発ホストの起動

**重要**: `vscode-inmu`フォルダを開いたVS Codeウィンドウで：

1. `F5`キーを押す
2. 新しいウィンドウが開く（タイトルに `[拡張機能開発ホスト]` と表示）

### ステップ3: テストファイルを開く

**拡張機能開発ホスト**のウィンドウ（新しく開いたウィンドウ）で：

1. `Ctrl+O` / `Cmd+O` でファイルを開くダイアログを表示
2. `vscode-inmu/test-sample.inmu` を開く

   **または**

3. 新規ファイルを作成（`Ctrl+N` / `Cmd+N`）
4. 以下を入力：
   ```inmu
   let x = 10
   print x
   ```
5. `Ctrl+S` / `Cmd+S` で保存時に `test.inmu` と名前を付ける

### ステップ4: 言語モードの確認

**拡張機能開発ホスト**のウィンドウで：

1. VS Code右下の言語モード表示（通常は「Plain Text」と表示）を確認
2. **「INMU」と表示されていればOK！** → ステップ5へ
3. 「Plain Text」や他の言語名が表示されている場合：
   - 言語モード表示をクリック
   - 検索ボックスに「inmu」と入力
   - 「INMU」を選択

### ステップ5: LSP機能の確認

**拡張機能開発ホスト**のウィンドウで、以下のファイルを開いて試してください：

```inmu
# 変数定義
let x = 10
let y = 20

# 関数定義
fn add(a, b) {
    return a + b
}

# 使用
let result = add(x, y)
print result
```

#### 確認項目：

**✅ シンタックスハイライト（すぐに見える）**
- `let`, `fn`, `return` が色付けされている
- 数字 `10`, `20` が色付けされている
- 文字列やコメントが色付けされている

**✅ 補完機能**
- 新しい行で `pr` と入力
- `Ctrl+Space` を押す
- `print` が候補に表示される

**✅ ホバー情報**
- `let` にマウスカーソルを合わせる
- ポップアップで説明が表示される

**✅ 定義ジャンプ**
- 下の方の `result` にカーソルを置く
- `F12` を押す
- `let result = ...` の行にジャンプする

**✅ 参照検索**
- `x` にカーソルを置く
- `Shift+F12` を押す
- 使用箇所のリストが表示される

**✅ シンボル一覧**
- `Ctrl+Shift+O` (Mac: `Cmd+Shift+O`) を押す
- `x`, `y`, `add`, `result` がリストに表示される

## トラブルシューティング

### シンタックスハイライトは効くがLSP機能が動かない

**原因**: LSPサーバーが起動していない

**確認方法**:

1. **拡張機能開発ホスト**のウィンドウで`F12`（開発者ツール）を押す
2. Consoleタブを確認
3. 以下のようなメッセージが表示されているか？
   ```
   INMU Extension activating...
   Starting INMU Language Server...
   INMU Language Server started successfully
   ```

**メッセージが表示されない場合**:
- `.inmu`ファイルを開いているか確認
- ファイルを閉じて、もう一度開く

**エラーメッセージが表示される場合**:
- エラー内容を確認
- 元のVS Codeウィンドウで `npm run compile` を実行
- 拡張機能開発ホストを閉じて、再度`F5`で起動

### 何も動かない

**チェック1: 正しいウィンドウで操作しているか？**

- ❌ 元のVS Codeウィンドウ（`vscode-inmu`フォルダを開いているウィンドウ）
- ✅ **拡張機能開発ホスト**のウィンドウ（新しく開いたウィンドウ）

**チェック2: `.inmu`ファイルを開いているか？**

- 右下の言語モードが「INMU」になっているか確認

**チェック3: コンパイルは成功しているか？**

元のVS Codeウィンドウで：
```bash
npm run compile
# エラーが出なければOK
```

### それでも動かない場合の最終手段

```bash
# 完全クリーンビルド
cd vscode-inmu
rm -rf out node_modules
npm install
npm run compile
```

その後、VS Codeを再起動して `F5` を押す

## 成功のサイン

以下がすべて動作すればLSPは完全に機能しています：

1. ✅ シンタックスハイライトが効く
2. ✅ `pr` + `Ctrl+Space` で `print` が補完される
3. ✅ キーワードにマウスを合わせると説明が出る
4. ✅ `F12` で定義にジャンプできる
5. ✅ `Shift+F12` で参照が検索できる
6. ✅ `Ctrl+Shift+O` でシンボル一覧が出る
7. ✅ エラーのあるコード（例: `let broken`）に赤い波線が表示される

## 次のステップ

LSPが動作したら：

1. より複雑なINMUコードを書いて試す
2. エラー診断機能を確認（わざと間違ったコードを書いてみる）
3. フォーマット機能を試す（`Shift+Alt+F` / `Shift+Option+F`）
4. コマンドパレットから「INMU: Run Current File」を試す

質問や問題があれば、具体的なエラーメッセージと一緒にお知らせください！
